---
title: 自动化测试
description: 杭州宏杉学习笔记-自动化测试
#cover: /cover/cover2.png
tag:
- 杭州宏杉
- 自动化测试
- Java
  #sticky: 999
date: 2025-07-29 10:35
---

## 自动化测试环境

* jdk1.8[https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html]
* maven3.9.3[https://maven.apache.org/]

## 项目结构

```text
mcloud_test/Test
├── lib     // 项目本地依赖jar包
│   ├── acl-0.0.1.jar
│   ├ ...
├── pom.xml     // 项目 pom.xml
├── ssl     // ssl相关工具
│   ├── DefaultSSLVerifier.java     // 默认ssl验证
│   ├── Readme.md
│   ├── ZSClient.java       // zstack ssl客户端
│   └── ZSConfig.java       // zstack ssl配置
├── test        // 主测试模块
│   ├── pom.xml     // 测试模块pom.xml
│   ├── src
│   │   └── test
│   │       ├── java ...
│   │       │    └── test
│   │       │        ├── api    // MCloud服务api
│   │       │        │   ├── Api.java
│   │       │        │   ├─ ...
│   │       │        ├── constant       // 常量定义
│   │       │        │   ├── ResourceConstant.java
│   │       │        │   ├─ ...
│   │       │        ├── deployer       // 部署器？（环境配置）相关
│   │       │        │   ├── AbstractDeployer.java
│   │       │        │   ├─ ...*.java
│   │       │        │   ├── schema     // 部署器配置模型
│   │       │        │   │   ├── AccountConfig.java
│   │       │        │   │   ├─ ...
│   │       │        ├── factory        // 工厂类
│   │       │        │   ├── BackupStorageFactory.java
│   │       │        │   ├─ ...
│   │       │        ├── FT     // 容错(Fault Tolerance)测试
│   │       │        │   ├── FtTest.java        // 测试基类
│   │       │        │   ├── host       // 物理机容错测试
│   │       │        │   │   ├── TestAllHostAlternatePowerOff.java      // 物理机交替掉电测试
│   │       │        │   │   ├─ ...
│   │       │        │   ├── synchronized_netcard       // 同步网卡测试
│   │       │        │   │   ├── TestAllHostAlternateDownABNetcard.java     // 物理机网卡交替关闭测试
│   │       │        │   │   ├─ ...
│   │       │        │   ├── Test1.java     // 测试用例前置，用于加载deployerXML配置文件
│   │       │        │   ├── TestSuite.java     // 测试用例套件
│   │       │        ├── HA     // 高可用(High Availability)相关测试
│   │       │        │   ├── HaTest.java        // 高可用测试基类
│   │       │        │   ├── host       // 物理机相关测试
│   │       │        │   │   ├── TestAllHostAlternatePowerOffOn.java
│   │       │        │   │   ├─ ...
│   │       │        │   ├── l2_netcard // L2网卡相关测试
│   │       │        │   │   ├── TestAllHostDownNetCard.java
│   │       │        │   │   ├─ ...
│   │       │        │   ├── Test1.java
│   │       │        │   └── TestSuite.java
│   │       │        ├── imageshare_mcloud      // 存储之间相互共享上传？
│   │       │        │   ├── image
│   │       │        │   │   ├── Test1.java
│   │       │        │   │   ├─ ...
│   │       │        │   └── vm
│   │       │        │       ├── LocalToMStor.java
│   │       │        │       ├─ ...
│   │       │        ├── local_mcloud       // Local存储的MCloud测试
│   │       │        │   ├── clonevm        // 克隆VM
│   │       │        │   │   ├── Test1.java
│   │       │        │   │   ├─ ...
│   │       │        │   ├── image      // 系统镜像相关测试
│   │       │        │   │   ├── Test1.java
│   │       │        │   │   ├─ ...
│   │       │        │   ├── instanceoffering       // 计算规格相关测试
│   │       │        │   │   ├── Test1.java
│   │       │        │   │   ├─ ...
│   │       │        │   ├── isovm      // 云主机iso相关测试
│   │       │        │   │   ├── Test1.java
│   │       │        │   │   ├─ ...
│   │       │        │   ├── migratevm      // 云主机迁移测试
│   │       │        │   │   ├── Test1.java
│   │       │        │   │   ├─ ...
│   │       │        │   ├── vm     // 云主机相关测试
│   │       │        │   │   ├── Test1.java
│   │       │        │   │   ├─ ...
│   │       │        │   ├── vmsnap     // 云主机快照相关测试
│   │       │        │   │   ├── Test1.java
│   │       │        │   │   ├─ ...
│   │       │        │   ├── volume     // 云盘相关测试
│   │       │        │   │   ├── Test1.java
│   │       │        │   │   ├─ ...
│   │       │        │   └── volumesnap // 云盘快照相关测试
│   │       │        │       ├── Test1.java
│   │       │        │       ├─ ...
│   │       │        ├── macrosan_mcloud_sdas       // 双活存储相关测试
│   │       │        │   ├── clonevm
│   │       │        │   ├── isovm
│   │       │        │   ├── migratevm
│   │       │        │   ├── repvm
│   │       │        │   ├── vm
│   │       │        │   ├── vmsnap
│   │       │        │   └── volume
│   │       │        ├── mdbs_mcloud        // MDBS相关测试
│   │       │        ├── psMigrate      // 跨物理机迁移测试
│   │       │        ├── sharedBlock_mcloud     // sharedBlock存储相关测试
│   │       │        ├── upgrade        // 升级测试
│   │       │        │   ├── before
│   │       │        │   │   ├── TestAttachVirtioDataVolumeWithRunningVm.java
│   │       │        │   │   ├─ ...
│   │       │        │   ├── Test1.java
│   │       │        │   ├─ ...
│   │       │        ├── util       // 工具类
│   │       │        │   ├── CommandUtil.java
│   │       │        │   ├─ ...
│   │       │        ├── BaseTest.java  // 测试基类
│   │       │        ├── CaseExceptionInterceptor.java      // 测试异常拦截器
│   │       │        ├── TestDeployer.java      // 以下5个文件未被使用
│   │       │        ├── package-info.java     
│   │       │        ├── TestScriptRunner.java
│   │       │        ├── UnitTestSuiteConfig.java
│   │       │        └── UnitTestSuite.java
│   │       └── resources
│   │           ├── caseRunShell        // 测试用例执行脚本
│   │           │   ├── case_run_base.sh
│   │           │   ├── case_run_ft.sh
│   │           │   ├── case_run_ha.sh
│   │           │   ├── case_run_image_share.sh
│   │           │   ├── case_run_migrate.sh
│   │           │   ├── case_run_nfs_base.sh
│   │           │   ├── case_run_nfs.sh
│   │           │   ├── case_run_san_sdas.sh
│   │           │   ├── case_run_sblk_base.sh
│   │           │   ├── case_run_sblk.sh
│   │           │   ├── case_run_sftp_base.sh
│   │           │   ├── case_run_sftp.sh
│   │           │   ├── case_run.sh
│   │           │   └── case_run_upgrade.sh
│   │           ├── deployerXml     // 测试用例配置文件
│   │           │   ├── ft
│   │           │   │   └── ft.xml
│   │           │   ├─ ...
│   │           ├── env     // 测试环境配置文件
│   │           ├── junit-platform.properties
│   │           ├── log4j2.xml
│   │           ├── mcloud.properties   // MCloud相关配置文件
│   │           ├── META-INF
│   │           │   ├── metafile.properties
│   │           │   └── services
│   │           │       └── org.junit.jupiter.api.extension.Extension
│   │           ├── psMigrateCrossPool.csv
│   │           ├── psMigrate.csv
│   │           ├── UnitTestSuiteConfig.xml
│   │           ├── unitTestSuiteXml
│   │           │   ├── AccountManager.xml
│   │           │   └── Vm.xml
│   │           ├── virsh_login         // 云主机功能相关脚本
│   │           │   ├── attach_guest_tools.sh
│   │           │   ├─ ...
│   │           └── xsd
│   │               ├── deployer
│   │               │   ├── compute.xsd
│   │               │   ├─ ...
│   │               └── UnitTestSuite.xsd

```

* 根据需要自动化测试的环境，对照文档《自动化教程》代码分类表格，确定执行的脚本和需要修改的代码。（如测试local主存储的脚本为case_run_sftp_base.sh，需要修改env文件和deployerXml/nfs_mcloud/nfs_mcloud.xml文件）
* env文件保存的为环境配置，例如管理节点IP，物理节点ip，bmcip，主存储类型，二层网络网卡名等
* deployerXml文件夹下的xml文件为环境中的资源配置，例如创建的计算规格参数，云盘规格参数，区域，集群和物理机，二三层网络配置，上传的镜像资源等

